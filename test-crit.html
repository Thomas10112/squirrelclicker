<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Gland Clicker â€” Test Crit</title>

    <!-- Bootstrap 5 CDN -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />

    <style>
        body {
            background: linear-gradient(180deg, #2e7d32, #1b5e20);
            color: #f1f8e9;
            min-height: 100vh;
        }

        .squirrel-card {
            background: rgba(0, 0, 0, 0.35);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 0 30px rgba(0,0,0,0.4);
        }

        .squirrel-btn {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .log-box {
            background: #0f172a;
            color: #e5e7eb;
            font-family: monospace;
            font-size: 0.9rem;
            padding: 1rem;
            border-radius: 0.5rem;
            height: 220px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="d-flex align-items-center justify-content-center">

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <div class="squirrel-card text-center">
                <h1 class="mb-3">ğŸ¿ï¸ Gland Clicker</h1>
                <p class="mb-4 text-success-emphasis">
                    Page de test â€” systÃ¨me de <strong>CRIT</strong>
                </p>

                <!-- STATS -->
                <div class="row mb-4">
                    <div class="col">
                        <div>ğŸŒ° Glands</div>
                        <div id="glands" class="fs-4 fw-bold">0</div>
                    </div>
                    <div class="col">
                        <div>ğŸ–±ï¸ Clicks</div>
                        <div id="clicks" class="fs-4 fw-bold">0</div>
                    </div>
                    <div class="col">
                        <div>ğŸ’¥ Crits</div>
                        <div id="crits" class="fs-4 fw-bold">0</div>
                    </div>
                </div>

                <!-- ACTIONS -->
                <div class="d-grid gap-3 mb-4">
                    <button id="btnClick" class="btn btn-success squirrel-btn">
                        ğŸŒ° Ramasser un gland
                    </button>

                    <button id="btnForceCrit" class="btn btn-warning squirrel-btn">
                        ğŸ’¥ Forcer un crit
                    </button>

                    <button id="btnStats" class="btn btn-info squirrel-btn">
                        ğŸ“Š Test 10 000 clics
                    </button>
                </div>

                <!-- LOG -->
                <div class="log-box" id="log"></div>
            </div>

        </div>
    </div>
</div>

<!-- Script principal -->
<script type="module">
    import {
        clickGland,
        getClickGainSansCrit
    } from "./crit.js";

    // --- STATE MINIMAL POUR TEST ---
    const state = {
        glands: "0",
        totalGlandsEarned: "0",
        totalClicks: "0",
        baseClick: "1",
        multipliers: {
            clickBps: 10000,
            prestigeBps: 10000,
            critChanceBps: 0,
            critMultBps: 0
        },
        stats: {
            crits: 0,
            bestClick: "0"
        }
    };

    // --- UI helpers ---
    const $ = (id) => document.getElementById(id);

    function refreshUI() {
        $("glands").textContent = state.glands;
        $("clicks").textContent = state.totalClicks;
        $("crits").textContent = state.stats.crits;
    }

    function log(msg) {
        const box = $("log");
        box.innerHTML += msg + "<br>";
        box.scrollTop = box.scrollHeight;
    }

    // --- Bouton clic ---
    $("btnClick").onclick = () => {
        clickGland(state);
        refreshUI();
    };

    // --- Forcer crit ---
    $("btnForceCrit").onclick = () => {
        state.multipliers.critChanceBps = 10000; // 100%
        state.multipliers.critMultBps = 30000 - 20000; // x3 total
        state.baseClick = "10";

        const before = state.glands;
        clickGland(state);

        log(`ğŸ’¥ CRIT forcÃ© : +${BigInt(state.glands) - BigInt(before)} glands`);
        refreshUI();
    };

    // --- Test statistiques ---
    $("btnStats").onclick = () => {
        state.glands = "0";
        state.totalClicks = "0";
        state.stats.crits = 0;
        state.baseClick = "1";
        state.multipliers.critChanceBps = 0;
        state.multipliers.critMultBps = 0;

        const N = 10000;
        for (let i = 0; i < N; i++) {
            clickGland(state);
        }

        log(`ğŸ“Š ${N} clics â†’ ${state.stats.crits} crits`);
        refreshUI();
    };

    refreshUI();
</script>
</body>
</html>
